<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì²œí•˜ì œì¼ ìŒì‹ ì›”ë“œì»µ: 32ê°•</title>
  <style>
    /* ì „ì²´ ë°°ê²½ê³¼ ê¸°ë³¸ í°íŠ¸ ì„¤ì • */
    body {
        background-color: #fff9f1; /* í¬ê·¼í•œ ì•„ì´ë³´ë¦¬ ë°°ê²½ */
        font-family: 'Malgun Gothic', sans-serif;
        color: #576574;
        text-align: center;
        padding-top: 50px;
    }

    /* ìƒë‹¨ ì œëª© ê¾¸ë¯¸ê¸° */
    #roundTitle {
        color: #ff9f43;
        font-size: 2.5rem;
        margin-bottom: 40px;
        text-shadow: 2px 2px 0px white; /* ê¸€ì ë’¤ì— í°ìƒ‰ ê·¸ë¦¼ì */
    }

    /* ìŒì‹ ì¹´ë“œê°€ ë‚˜ë€íˆ ë†“ì¼ ë°”êµ¬ë‹ˆ */
    .container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 40px;
    }

    /* ğŸ” ìŒì‹ ì¹´ë“œ ë””ìì¸ (í•µì‹¬!) */
    .food-card {
        cursor: pointer;
        background: white;
        border: 4px solid #ffeaa7; /* ì—°í•œ ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ */
        padding: 15px;
        border-radius: 30px; /* ì•„ì£¼ ë‘¥ê¸€ë‘¥ê¸€í•˜ê²Œ */
        box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        transition: all 0.3s ease; /*  ë¶€ë“œëŸ¬ìš´ ë³€í™”ë¥¼ ìœ„í•œ ì£¼ë¬¸ */
        width: 380px;
        overflow: hidden;
        flex-direction: column; /* ì‚¬ì§„ê³¼ ì´ë¦„ì„ ì„¸ë¡œë¡œ ë°°ì¹˜ */
        display: flex;
    }

    /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ì‚´ì§ ì»¤ì§€ëŠ” íš¨ê³¼ */
    .food-card:hover {
    transform: scale(1.08); /* í™”ë©´ ìª½ìœ¼ë¡œ 8%ë§Œí¼ ì‚´ì§ ì»¤ì§„ë‹¤ */
    border-color: #ff9f43;  /* í…Œë‘ë¦¬ê°€ ì§„í•œ ì£¼í™©ìƒ‰ìœ¼ë¡œ ë°”ë€ë‹¤ */
    box-shadow: 0 20px 40px rgba(255, 159, 67, 0.3); /*  ì•„ë˜ì— ì£¼í™©ìƒ‰ ê·¸ë¦¼ìê°€ ìƒê²¨ ë¶• ë–  ë³´ì¸ë‹¤ */
    z-index: 10; /* ë‹¤ë¥¸ ì¹´ë“œë³´ë‹¤ ìœ„ë¡œ ì˜¬ë¼ì˜¤ê²Œ í•œë‹¤ */
    }

    /* ğŸ–±ï¸ ë§ˆìš°ìŠ¤ë¥¼ ê¾¹ ëˆŒë €ì„ ë•Œ (í´ë¦­í•˜ëŠ” ìˆœê°„) */
    .food-card:active {
    transform: scale(0.95); /* ì‚´ì§ ëˆŒë¦¬ëŠ” ëŠë‚Œì„ ì£¼ê¸° ìœ„í•´ 5% ì‘ì•„ì§„ë‹¤ */
    background-color: #fff4e6; /* ì¹´ë“œ ë°°ê²½ìƒ‰ì´ ì‚´ì§ ì£¼í™©ë¹›ìœ¼ë¡œ ë³€í•œë‹¤ */
    border-color: #ff6b6b; /*  í…Œë‘ë¦¬ê°€ ê°•ë ¬í•œ ë¶„í™ë¹›ìœ¼ë¡œ ë°˜ì§ì¸ë‹¤ */
    box-shadow: inset 0 5px 10px rgba(0,0,0,0.1); /*  ì•ˆìª½ìœ¼ë¡œ ê·¸ë¦¼ìê°€ ìƒê²¨ ëˆŒë¦° íš¨ê³¼ë¥¼ ì¤€ë‹¤ */
    }

    /* ì„ íƒëœ ëŠë‚Œì„ ê°•ì¡°í•˜ê¸° ìœ„í•œ ì• ë‹ˆë©”ì´ì…˜ (ì„ íƒ ì‚¬í•­) */
    @keyframes clickEffect {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
    }

    .food-card:active img {
    animation: clickEffect 0.1s; /* ì‚¬ì§„ì´ ì°°ì¹µí•˜ëŠ” ëŠë‚Œìœ¼ë¡œ ê¹œë¹¡ì…ë‹ˆë‹¤ */
    }

    /* ì´ë¯¸ì§€ í…Œë‘ë¦¬ ë‹¤ë“¬ê¸° */
    img {
        border-radius: 20px;
        object-fit: cover;
        border: 2px solid #ffeaa7;
        width: 100%;
        height: 300px;
    }

    /* ì¤‘ê°„ì˜ VS ê¸€ì ê¾¸ë¯¸ê¸° */
    h1:not(#roundTitle) {
        color: #ff6b6b;
        font-size: 3rem;
        font-style: italic;
    }

    /* ìŒì‹ ì´ë¦„ í°íŠ¸ */
    h2 { margin-top: 15px; font-size: 1.8rem; color: #2d3436;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
<h1 id="roundTitle">ìŒì‹ ì›”ë“œì»µ: 32ê°• ğŸ†</h1>

<div class="container">
  <div class="food-card" onclick="chooseFood(0)">
    <img id="food1Img" src="" width="400" height="400">
    <h2 id="food1Name">ìŒì‹ 1</h2>
  </div>

  <h1>VS</h1>

  <div class="food-card" onclick="chooseFood(1)">
    <img id="food2Img" src="" width="400" height="400">
    <h2 id="food2Name">ìŒì‹ 2</h2>
  </div>
</div>

<script th:inline="javascript">
  /*<![CDATA[*/
  // 1. ì„œë²„(Controller)ê°€ ë³´ë‚´ì¤€ 32ëª… ì„ ìˆ˜ ëª…ë‹¨ì„ ë¦¬ìŠ¤íŠ¸(Array)ë¡œ ë°›ëŠ”ë‹¤.
  let foods = /*[[${foodList}]]*/ [];
  let winners = []; // ëŒ€ê²°ì—ì„œ ì´ê¸´ ì„ ìˆ˜ë“¤ì„ ì„ì‹œë¡œ ë‹´ì•„ë‘˜ ë°”êµ¬ë‹ˆ.
  let index = 0;    // í˜„ì¬ ëª‡ ë²ˆì§¸ ì„ ìˆ˜ë¥¼ ë³´ì—¬ì¤„ì§€ ê°€ë¦¬í‚¤ëŠ” ì†ê°€ë½ ë²ˆí˜¸.
  let round = 32;   // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë¼ìš´ë“œ ì •ë³´.

  // 2. í™”ë©´ì— í˜„ì¬ ëŒ€ê²° ì¤‘ì¸ ë‘ ìŒì‹ì„ ê·¸ë ¤ì£¼ëŠ” í•¨ìˆ˜.
  function showMatch() {
      // ì´ë²ˆ ë¼ìš´ë“œ ëŒ€ê²°ì´ ëª¨ë‘ ëë‚¬ì„ ë•Œ (32ê°• ì¢…ë£Œ -> 16ê°• ì§„ì¶œì ê²°ì •)
      if (index >= foods.length) {
          if (winners.length === 1) {
              alert("ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ìµœì¢… ìš°ìŠ¹ì€ [" + winners[0].foodName + "] ì…ë‹ˆë‹¤!");
              location.href = "/"; // ê²Œì„ ì¢…ë£Œ í›„ í™ˆìœ¼ë¡œ ì´ë™
              return;
          }
          // ë‹¤ìŒ ë¼ìš´ë“œ ì„¸íŒ…: ìŠ¹ì ë°”êµ¬ë‹ˆë¥¼ ìƒˆë¡œìš´ ì„ ìˆ˜ ëª…ë‹¨ìœ¼ë¡œ êµì²´.
          foods = [...winners];
          winners = [];
          index = 0;
          round = round / 2;
         if (round === 2) {
    // 2ê°•(ê²°ìŠ¹ì „)ì¼ ë•Œë§Œ ì‹¤í–‰ë˜ëŠ” íŠ¹ë³„ ë©˜íŠ¸.
    document.getElementById('roundTitle').innerText = "ìŒì‹ ì›”ë“œì»µ: ê²°ìŠ¹ì „ ğŸ†";
    alert("ğŸ”¥ ë“œë””ì–´ ê²°ìŠ¹ì „ì„ ì‹œì‘í•©ë‹ˆë‹¤! ğŸ”¥");
} else {
    // í‰ì†Œ(32, 16, 8, 4ê°•)ì—ëŠ” ì›ë˜ëŒ€ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
    document.getElementById('roundTitle').innerText = "ìŒì‹ ì›”ë“œì»µ: " + round + "ê°• ğŸ†";
    alert(round + "ê°• ëŒ€ê²°ì„ ì‹œì‘í•©ë‹ˆë‹¤!");
         }
      }

      // í™”ë©´ì˜ ì´ë¯¸ì§€ì™€ ì´ë¦„ì„ í˜„ì¬ ìˆœì„œ(index)ì— ë§ê²Œ ë°”ê¿ˆ.
   // 1ë²ˆ ìŒì‹ ì‚¬ì§„ê³¼ ì´ë¦„ êµì²´
    document.getElementById('food1Img').src = foods[index].imagePath;  // ğŸ‘ˆ imagePath ì…ë‹ˆë‹¤!
    document.getElementById('food1Name').innerText = foods[index].foodName; // ğŸ‘ˆ foodName ì…ë‹ˆë‹¤!

    // 2ë²ˆ ìŒì‹ ì‚¬ì§„ê³¼ ì´ë¦„ êµì²´
    document.getElementById('food2Img').src = foods[index+1].imagePath;
    document.getElementById('food2Name').innerText = foods[index+1].foodName;
}
  // ê·¸ ì•„ë˜ì— í´ë¦­ í•¨ìˆ˜(chooseFood)ê°€ ì´ì–´ì ¸ì•¼ í•œë‹¤.
    function chooseFood(order) {
    let winner = foods[index + order];
    winners.push(winner);
    index += 2;
    // ğŸ† ìš°ìŠ¹ìê°€ ê²°ì •ë˜ì—ˆì„ ë•Œ!
    // ğŸ† ìš°ìŠ¹ìê°€ ê²°ì •ë˜ì—ˆì„ ë•Œ!
    if (index >= foods.length && winners.length === 1) {
        let winnerName = winners[0].foodName; // ğŸ‘ˆ [ì¶”ê°€] ìš°ìŠ¹ ìŒì‹ ì´ë¦„ ì €ì¥
        let winnerId = winners[0].foodId;

        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 }
        });

        // ì„œë²„ì— ìš°ìŠ¹ ê¸°ë¡ ì €ì¥ (AJAX)
        fetch('/game/win?id=' + winnerId, { method: 'POST' })
            .then(response => {
                // ğŸ’¡ í­ì£½ì„ ì ì‹œ ê°ìƒí•  ìˆ˜ ìˆê²Œ 1.5ì´ˆ(1500) ë’¤ì— ì•Œë¦¼ì„ ë„ì›€.
                setTimeout(() => {
         // 1. ì‚¬ìš©ìì—ê²Œ ë§›ì§‘ ê²€ìƒ‰ ì˜ì‚¬ë¥¼ ë¬»ê¸°.
         if (confirm("ğŸ‰ ìµœì¢… ìš°ìŠ¹ì€ [" + winnerName + "] ì…ë‹ˆë‹¤!\nì£¼ë³€ ë§›ì§‘ì„ ê²€ìƒ‰í•´ ë“œë¦´ê¹Œìš”?")) {
         // 2. [í™•ì¸] í´ë¦­ ì‹œ: ì¹´ì¹´ì˜¤ ë§µ ê²€ìƒ‰ ì°½ì„ ìƒˆ íƒ­ìœ¼ë¡œ ë„ì›ë‹ˆë‹¤.
         let searchUrl = "https://map.kakao.com/link/search/" + encodeURIComponent(winnerName + " ë§›ì§‘");
         window.open(searchUrl, '_blank');

         // 3. ì§€ë„ë¥¼ ë„ìš´ í›„ ë©”ì¸ìœ¼ë¡œ ë³µê·€í•©ë‹ˆë‹¤.
         location.href = "/";
    } else {
        // 4. [ì·¨ì†Œ] í´ë¦­ ì‹œ: ë°”ë¡œ ë©”ì¸ìœ¼ë¡œ ë³µê·€í•©ë‹ˆë‹¤.
        location.href = "/";
    }
}, 1500);
            });
        return;
    }
    showMatch();
}
  window.onload = showMatch; // í˜ì´ì§€ ì—´ë¦¬ìë§ˆì ê²Œì„ ì‹œì‘!
/*]]>*/
</script>
</body>
</html>

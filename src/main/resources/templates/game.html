<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì²œí•˜ì œì¼ ìŒì‹ ì›”ë“œì»µ: </title>
  <style>
    /* ì „ì²´ ë°°ê²½ê³¼ ê¸°ë³¸ í°íŠ¸ ì„¤ì • */
    body {
        background-color: #fff9f1; /* í¬ê·¼í•œ ì•„ì´ë³´ë¦¬ ë°°ê²½ */
        font-family: 'Malgun Gothic', sans-serif;
        color: #576574;
        text-align: center;
        padding-top: 50px;
    }

    /* ìƒë‹¨ ì œëª© ê¾¸ë¯¸ê¸° */
    #roundTitle {
        color: #ff9f43;
        font-size: 2.5rem;
        margin-bottom: 40px;
        text-shadow: 2px 2px 0px white; /* ê¸€ì ë’¤ì— í°ìƒ‰ ê·¸ë¦¼ì */
    }

    /* ìŒì‹ ì¹´ë“œê°€ ë‚˜ë€íˆ ë†“ì¼ ë°”êµ¬ë‹ˆ */
    .container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 40px;
    }

    /* ğŸ” ìŒì‹ ì¹´ë“œ ë””ìì¸ (í•µì‹¬!) */
    .food-card {
        cursor: pointer;
        background: white;
        border: 4px solid #ffeaa7; /* ì—°í•œ ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ */
        padding: 15px;
        border-radius: 30px; /* ì•„ì£¼ ë‘¥ê¸€ë‘¥ê¸€í•˜ê²Œ */
        box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        transition: all 0.3s ease; /*  ë¶€ë“œëŸ¬ìš´ ë³€í™”ë¥¼ ìœ„í•œ ì£¼ë¬¸ */
        width: 380px;
        overflow: hidden;
        flex-direction: column; /* ì‚¬ì§„ê³¼ ì´ë¦„ì„ ì„¸ë¡œë¡œ ë°°ì¹˜ */
        display: flex;
    }

    /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ì‚´ì§ ì»¤ì§€ëŠ” íš¨ê³¼ */
    .food-card:hover {
    transform: scale(1.08); /* í™”ë©´ ìª½ìœ¼ë¡œ 8%ë§Œí¼ ì‚´ì§ ì»¤ì§„ë‹¤ */
    border-color: #ff9f43;  /* í…Œë‘ë¦¬ê°€ ì§„í•œ ì£¼í™©ìƒ‰ìœ¼ë¡œ ë°”ë€ë‹¤ */
    box-shadow: 0 20px 40px rgba(255, 159, 67, 0.3); /*  ì•„ë˜ì— ì£¼í™©ìƒ‰ ê·¸ë¦¼ìê°€ ìƒê²¨ ë¶• ë–  ë³´ì¸ë‹¤ */
    z-index: 10; /* ë‹¤ë¥¸ ì¹´ë“œë³´ë‹¤ ìœ„ë¡œ ì˜¬ë¼ì˜¤ê²Œ í•œë‹¤ */
    }

    /* ğŸ–±ï¸ ë§ˆìš°ìŠ¤ë¥¼ ê¾¹ ëˆŒë €ì„ ë•Œ (í´ë¦­í•˜ëŠ” ìˆœê°„) */
    .food-card:active {
    transform: scale(0.95); /* ì‚´ì§ ëˆŒë¦¬ëŠ” ëŠë‚Œì„ ì£¼ê¸° ìœ„í•´ 5% ì‘ì•„ì§„ë‹¤ */
    background-color: #fff4e6; /* ì¹´ë“œ ë°°ê²½ìƒ‰ì´ ì‚´ì§ ì£¼í™©ë¹›ìœ¼ë¡œ ë³€í•œë‹¤ */
    border-color: #ff6b6b; /*  í…Œë‘ë¦¬ê°€ ê°•ë ¬í•œ ë¶„í™ë¹›ìœ¼ë¡œ ë°˜ì§ì¸ë‹¤ */
    box-shadow: inset 0 5px 10px rgba(0,0,0,0.1); /*  ì•ˆìª½ìœ¼ë¡œ ê·¸ë¦¼ìê°€ ìƒê²¨ ëˆŒë¦° íš¨ê³¼ë¥¼ ì¤€ë‹¤ */
    }

    /* ì„ íƒëœ ëŠë‚Œì„ ê°•ì¡°í•˜ê¸° ìœ„í•œ ì• ë‹ˆë©”ì´ì…˜ (ì„ íƒ ì‚¬í•­) */
    @keyframes clickEffect {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
    }

    .food-card:active img {
    animation: clickEffect 0.1s; /* ì‚¬ì§„ì´ ì°°ì¹µí•˜ëŠ” ëŠë‚Œìœ¼ë¡œ ê¹œë¹¡ì…ë‹ˆë‹¤ */
    }

    /* ì´ë¯¸ì§€ í…Œë‘ë¦¬ ë‹¤ë“¬ê¸° */
    img {
        border-radius: 20px;
        object-fit: cover;
        border: 2px solid #ffeaa7;
        width: 100%;
        height: 300px;
    }

    /* ì¤‘ê°„ì˜ VS ê¸€ì ê¾¸ë¯¸ê¸° */
    h1:not(#roundTitle) {
        color: #ff6b6b;
        font-size: 3rem;
        font-style: italic;
    }

    /* ìŒì‹ ì´ë¦„ í°íŠ¸ */
    h2 { margin-top: 15px; font-size: 1.8rem; color: #2d3436;}

    /* ğŸŒŸ ì¹´ë“œê°€ ë‚˜íƒ€ë‚  ë•Œ ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ ë°€ë ¤ì˜¤ëŠ” íš¨ê³¼ ì„¤ì • */
    @keyframes slideIn {
    from { transform: translateX(50px); opacity: 0; } /* 50px ì˜†ì—ì„œ íˆ¬ëª…í•˜ê²Œ ì‹œì‘ */
    to { transform: translateX(0); opacity: 1; }      /* ì œìë¦¬ë¡œ ì˜¤ë©´ì„œ ì„ ëª…í•´ì§ */
   }

   /* ì• ë‹ˆë©”ì´ì…˜ì„ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•  ì´ë¦„í‘œ(í´ë˜ìŠ¤) */
    .fade-in {
    animation: slideIn 0.5s ease-out forwards;
   }

   /* ë§í¬ ë³µì‚¬ ì•Œë¦¼ì°½ ë””ìì¸ */
    .copy-alert {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 10px 25px;
    border-radius: 30px;
    z-index: 9999; /* ë‹¤ë¥¸ í™”ë©´ë³´ë‹¤ ê°€ì¥ ìœ„ì— ëœ¨ê²Œ ì„¤ì • */
    display: none; /* í‰ì†Œì—ëŠ” ìˆ¨ê¹€ */
}

  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
<div id="game-board">
  <h1 id="roundTitle">ìŒì‹ ì›”ë“œì»µ:  ğŸ†</h1>
  <div id="progress-info" style="font-size: 1.5rem; color: #ff6b6b; margin-bottom: 20px; font-weight: bold;">
    í˜„ì¬ ì§„í–‰: <span id="currentMatch">1</span> / <span id="totalMatches">16</span>
  </div>
  <div class="container">
    <div class="food-card" onclick="chooseFood(0)">
      <img id="food1Img" src="" width="400" height="400">
      <h2 id="food1Name">ìŒì‹ 1</h2>
    </div>
    <h1>VS</h1>
    <div class="food-card" onclick="chooseFood(1)">
      <img id="food2Img" src="" width="400" height="400">
      <h2 id="food2Name">ìŒì‹ 2</h2>
    </div>
  </div>
</div>

<div id="result-screen" style="display: none; padding-top: 50px;">
  <h1 style="color: #ff9f43; font-size: 3.5rem; margin-bottom: 20px;">ğŸŠ ìµœì¢… ìš°ìŠ¹ ğŸŠ</h1>
  <div class="food-card" style="margin: 0 auto; cursor: default; transform: scale(1.1); border-color: #ff9f43;">
    <img id="winnerImg" src="" style="width: 100%; height: 400px; object-fit: cover;">
    <h2 id="winnerName" style="font-size: 2.5rem; color: #ff6b6b;">ìŒì‹ ì´ë¦„</h2>
  </div>
  <div style="margin-top: 50px; display: flex; justify-content: center; gap: 20px;">
    <button onclick="location.href='/'" style="padding: 15px 30px; font-size: 1.2rem; border-radius: 15px; border: none; background: #ee5253; color: white; cursor: pointer;">í™ˆìœ¼ë¡œ ê°€ê¸°</button>
    <button id="searchBtn" style="padding: 15px 30px; font-size: 1.2rem; border-radius: 15px; border: none; background: #feca57; color: #222f3e; cursor: pointer; font-weight: bold;">ì£¼ë³€ ë§›ì§‘ ê²€ìƒ‰</button>
    <button onclick="location.href='/game'" style="padding: 15px 30px; font-size: 1.2rem; border-radius: 15px; border: none; background: #ee5253; color: white; cursor: pointer;"> ë‹¤ì‹œ ì‹œì‘</button>
    <button onclick="location.href='/ranking'" style="padding: 15px 30px; font-size: 1.2rem; border-radius: 15px; border: none; background: #54a0ff; color: white; cursor: pointer;">ë­í‚¹ ë³´ê¸°</button>
    <button onclick="copyToClipboard()" style="padding: 15px 30px; font-size: 1.2rem; border-radius: 15px; border: none; background: #1dd1a1; color: white; cursor: pointer;"> ê³µìœ í•˜ê¸°</button>
  </div>
  <div id="copyAlert" class="copy-alert">ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
</div>

<script th:inline="javascript">
  /*<![CDATA[*/
  // 1. ë°ì´í„° ì¤€ë¹„ (ë¹„ìœ : ì„ ìˆ˜ ëª…ë‹¨ ì‘ì„±)
  let foods = /*[[${foodList}]]*/ [];
  let winners = [];
  let index = 0;
  let round = foods.length;

  // 2. í™”ë©´ì— ì„ ìˆ˜ë“¤ì„ ë°°ì¹˜í•˜ëŠ” í•¨ìˆ˜ (ë¹„ìœ : ë¬´ëŒ€ ì—°ì¶œ)
function showMatch() {
    // ğŸŒŸ [ì¶”ê°€] URLì—ì„œ ì¹´í…Œê³ ë¦¬ì™€ ì´ˆê¸° ë¼ìš´ë“œ ì •ë³´ë¥¼ ì½ì–´ì˜µë‹ˆë‹¤.
    const urlParams = new URLSearchParams(window.location.search);
    const categoryParam = urlParams.get('category') || 'all'; // URLì— ì—†ìœ¼ë©´ 'all'

    // ì¹´í…Œê³ ë¦¬ ì˜ë¬¸ëª…ì„ ì˜ˆìœ í•œê¸€ë¡œ ë°”ê¿”ì£¼ëŠ” í†µì—­ì‚¬ ëª…ë‹¨ì…ë‹ˆë‹¤.
    const categoryMap = {
        'all': 'ì „ì²´',
        'korean': 'í•œì‹', 'í•œì‹': 'í•œì‹',
        'chinese': 'ì¤‘ì‹', 'ì¤‘ì‹': 'ì¤‘ì‹',
        'japanese': 'ì¼ì‹', 'ì¼ì‹': 'ì¼ì‹',
        'western': 'ì–‘ì‹', 'ì–‘ì‹': 'ì–‘ì‹',
        'asian': 'ì•„ì‹œì•ˆì‹', 'ì•„ì‹œì•ˆì‹': 'ì•„ì‹œì•ˆì‹'
    };
    const categoryKorean = categoryMap[categoryParam] || 'ìŒì‹';

    // ë¼ìš´ë“œê°€ ëë‚¬ëŠ”ì§€ í™•ì¸
    if (index >= foods.length) {
        if (winners.length === 1) {
            return;
        }
        foods = [...winners];
        winners = [];
        index = 0;
        round = round / 2;

        // ğŸŒŸ [ìˆ˜ì •] ì•Œë¦¼ì°½(alert)ì—ë„ ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ ë„£ì–´ì¤€ë‹¤.
        const roundText = (round === 2) ? "ê²°ìŠ¹ì „" : round + "ê°•";
        alert(`[${categoryKorean}] ${roundText} ëŒ€ê²°ì„ ì‹œì‘í•©ë‹ˆë‹¤!`);
    }

    // ğŸŒŸ [í•µì‹¬ ìˆ˜ì •] ìƒë‹¨ ì œëª© ì „ê´‘íŒì— ì¹´í…Œê³ ë¦¬ì™€ ëª‡ ê°•ì¸ì§€ ëª¨ë‘ í‘œì‹œ.
    const displayRound = (round === 2) ? "ê²°ìŠ¹ì „" : round + "ê°•";
    document.getElementById('roundTitle').innerText = `ìŒì‹ ì›”ë“œì»µ [${categoryKorean}]: ${displayRound} ğŸ†`;

    // ì§„í–‰ íšŸìˆ˜ ì—…ë°ì´íŠ¸ (ex: 1 / 16)
    document.getElementById('currentMatch').innerText = (index / 2) + 1;
    document.getElementById('totalMatches').innerText = foods.length / 2;

    // ì‚¬ì§„ê³¼ ì´ë¦„ êµì²´ (ì „ê´‘íŒ ê°ˆì•„ ë¼ìš°ê¸°)
    document.getElementById('food1Img').src = foods[index].imagePath;
    document.getElementById('food1Name').innerText = foods[index].foodName;
    document.getElementById('food2Img').src = foods[index+1].imagePath;
    document.getElementById('food2Name').innerText = foods[index+1].foodName;
}

  // 3. ìŒì‹ì„ í´ë¦­í–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (ë¹„ìœ : ìŠ¹ì íŒì • ë° í™”ë©´ ì´ë™)
  function chooseFood(order) {
      let winner = foods[index + order];
      winners.push(winner);
      index += 2;

      const container = document.querySelector('.container');
      container.style.opacity = '0'; // ğŸŒŸ ë‹¤ìŒ ì¥ë©´ ì¤€ë¹„ë¥¼ ìœ„í•´ ì ì‹œ ì–´ë‘¡ê²Œ (ì•”ì „)

      setTimeout(() => {
          // ğŸ† [í•µì‹¬] ìµœì¢… ìš°ìŠ¹ìê°€ ê²°ì •ë˜ì—ˆì„ ë•Œ!
          if (index >= foods.length && winners.length === 1) {
              const finalWinner = winners[0];

              // í­ì£½ íŒ¡íŒ¡!
              confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });

              // ğŸŒŸ ì‹œìƒëŒ€ í™”ë©´ìœ¼ë¡œ êµì²´ (ì¤‘ìš”!)
              document.getElementById('game-board').style.display = 'none'; // ê²Œì„íŒ ìˆ¨ê¹€
              document.getElementById('result-screen').style.display = 'block'; // ì‹œìƒëŒ€ ë³´ì„

              // ì‹œìƒëŒ€ì— ìš°ìŠ¹ì ì •ë³´ ê¸°ë¡
              document.getElementById('winnerImg').src = finalWinner.imagePath;
              document.getElementById('winnerName').innerText = finalWinner.foodName;

              // ë§›ì§‘ ê²€ìƒ‰ ë²„íŠ¼ ê¸°ëŠ¥ ì—°ê²°
              document.getElementById('searchBtn').onclick = function() {
                  window.open("https://map.kakao.com/link/search/" + encodeURIComponent(finalWinner.foodName + " ë§›ì§‘"), '_blank');
              };

              // ì„œë²„ì— ê²°ê³¼ ì „ì†¡
              fetch('/game/win?id=' + finalWinner.foodId, { method: 'POST' });
              return;
          }

          // âš”ï¸ ë‹¤ìŒ ëŒ€ê²° ì§„í–‰
          showMatch();

          // ğŸŒŸ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ (ìŠ¬ë¼ì´ë“œì²˜ëŸ¼ ë°€ë ¤ì˜¤ê¸°)
          container.style.opacity = '1';
          container.classList.remove('fade-in');
          void container.offsetWidth; // ë¬´ëŒ€ ì¥ì¹˜ ë¦¬ì…‹ (ë¸Œë¼ìš°ì € ê°•ì œ ìƒˆë¡œê³ ì¹¨)
          container.classList.add('fade-in');

      }, 300); // 0.3ì´ˆ ë’¤ì— ë‹¤ìŒ ëŒ€ê²° ë“±ì¥
  }

  window.onload = showMatch; // í˜ì´ì§€ ì—´ë¦¬ë©´ ì²« ëŒ€ê²° ì‹œì‘

  // ğŸ”— í˜„ì¬ í˜ì´ì§€ì˜ ì£¼ì†Œë¥¼ ë³µì‚¬í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
   function copyToClipboard() {
    // 1. í˜„ì¬ ë¸Œë¼ìš°ì €ì˜ ì£¼ì†Œì°½ URLì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
    const currentUrl = window.location.href;

    // 2. í´ë¦½ë³´ë“œì— ì£¼ì†Œë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤. (ë¹„ìœ : ë©”ëª¨ì¥ì— ì£¼ì†Œë¥¼ ì ì–´ ì»´í“¨í„°ì— ì €ì¥)
    navigator.clipboard.writeText(currentUrl).then(() => {
        // 3. ë³µì‚¬ê°€ ì„±ê³µí•˜ë©´ ì‚¬ìš©ìì—ê²Œ ì•Œë ¤ì¤ë‹ˆë‹¤.
        const alertBox = document.getElementById('copyAlert');
        alertBox.style.display = 'block'; // ìˆ¨ê²¨ì§„ ë©”ì‹œì§€ ë³´ì´ê¸°

        // 2ì´ˆ ë’¤ì— ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ìˆ¨ê¹ë‹ˆë‹¤.
        setTimeout(() => {
            alertBox.style.display = 'none';
        }, 2000);
    }).catch(err => {
        // ë³µì‚¬ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼ (ì˜ˆì™¸ ì²˜ë¦¬)
        alert("ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œì°½ì„ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”!");
    });
}
/*]]>*/

</script>
</body>
</html>

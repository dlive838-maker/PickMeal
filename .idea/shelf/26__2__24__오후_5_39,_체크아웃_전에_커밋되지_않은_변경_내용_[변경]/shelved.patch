Index: PickMeal/src/main/java/PickMeal/PickMeal/controller/UserController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package PickMeal.PickMeal.controller;\r\n\r\nimport PickMeal.PickMeal.domain.User;\r\nimport PickMeal.PickMeal.service.UserService;\r\nimport jakarta.servlet.http.HttpSession;\r\nimport lombok.RequiredArgsConstructor;\r\nimport org.springframework.beans.propertyeditors.CustomDateEditor;\r\nimport org.springframework.security.core.Authentication;\r\nimport org.springframework.security.core.annotation.AuthenticationPrincipal;\r\nimport org.springframework.security.crypto.password.PasswordEncoder;\r\nimport org.springframework.security.oauth2.client.authentication.OAuth2AuthenticationToken;\r\nimport org.springframework.security.oauth2.core.user.OAuth2User;\r\nimport org.springframework.stereotype.Controller;\r\nimport org.springframework.ui.Model;\r\nimport org.springframework.web.bind.WebDataBinder;\r\nimport org.springframework.web.bind.annotation.*;\r\nimport org.springframework.web.servlet.mvc.support.RedirectAttributes;\r\n\r\nimport java.text.SimpleDateFormat;\r\n\r\n@Controller\r\n@RequestMapping(\"/users\")\r\n@RequiredArgsConstructor\r\npublic class UserController {\r\n    private final UserService userService;\r\n    private final PasswordEncoder passwordEncoder;\r\n\r\n    @GetMapping(\"/signup\")\r\n    public String signupForm(Model model) {\r\n        model.addAttribute(\"user\", new User()); // 일반 가입 시 빈 유저 객체 바인딩\r\n        model.addAttribute(\"isSocial\", false); // 프론트에서 소셜 유저임을 판별\r\n        return \"users/signup\";\r\n    }\r\n\r\n    @PostMapping(\"/signup\")\r\n    public String signUp(User user, RedirectAttributes rttr){\r\n        try {\r\n            userService.signUp(user); // 가입 로직 호출\r\n            rttr.addFlashAttribute(\"msg\", \"회원가입이 완료되었습니다.\");\r\n            return \"redirect:/users/login\";\r\n        } catch (IllegalStateException e){\r\n            rttr.addFlashAttribute(\"msg\", e.getMessage()); // 중복 가입 에러 메시지 전달\r\n            return \"redirect:/users/signup\";\r\n        }\r\n    }\r\n\r\n    @GetMapping(\"/check-id\")\r\n    @ResponseBody // JSON/문자열 데이터만 반환\r\n    public String checkId(@RequestParam(\"id\") String id) {\r\n        if (id == null || id.trim().isEmpty()) return \"invalid\";\r\n        return userService.isIdDuplicate(id) ? \"fail\" : \"success\"; // 중복 검사 결과 반환\r\n    }\r\n\r\n    @GetMapping(\"/check-nickname\") // 중복 체크를 위한 별도 경로\r\n    @ResponseBody // 페이지가 아닌 '데이터(문자열)'만 응답하기 위해 사용\r\n    public String checkNicknameDuplication(@RequestParam(\"nickname\") String nickname) {\r\n        if (nickname == null || nickname.trim().isEmpty()) {\r\n            return \"invalid\";\r\n        }\r\n        // 1. 서비스에 닉네임 중복 확인 요청\r\n        boolean isExist = userService.existsByNickname(nickname);\r\n\r\n        // 2. 결과에 따라 성공/실패 메시지 반환\r\n        return isExist ? \"fail\" : \"success\";\r\n    }\r\n\r\n    @GetMapping(\"/signup/social\")\r\n    public String socialSignupForm(@RequestParam String socialId, @RequestParam String email, @RequestParam String site, @RequestParam String name, Model model) {\r\n        User socialUser = new User(); // 소셜 전용 유저 객체 생성\r\n        socialUser.setSocialId(socialId);\r\n        socialUser.setSocialLoginSite(site);\r\n        socialUser.setNickname(name);\r\n        socialUser.setEmail(email);\r\n        socialUser.setId(site + \"_\" + socialId); // 예: google_12345\r\n        model.addAttribute(\"user\", socialUser); // 폼에 미리 채워진 데이터 전달\r\n        model.addAttribute(\"isSocial\", true); // 프론트에서 소셜 유저임을 판별\r\n        return \"users/signup\";\r\n    }\r\n\r\n\r\n    @InitBinder\r\n    public void initBinder(WebDataBinder binder) {\r\n        // yyyy-MM-dd 형식을 Date 객체로 변환해주는 도구를 등록합니다.\r\n        SimpleDateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n        dateFormat.setLenient(false); // 엄격한 날짜 체크\r\n        binder.registerCustomEditor(java.util.Date.class, new CustomDateEditor(dateFormat, true));\r\n    }\r\n\r\n    @GetMapping(\"/login\")\r\n    public String loginForm(HttpSession session, Model model) {\r\n        // 세션에서 에러 메시지 꺼내기\r\n        String errorMessage = (String) session.getAttribute(\"errorMessage\");\r\n\r\n        if (errorMessage != null) {\r\n            model.addAttribute(\"errorMessage\", errorMessage); // 화면으로 전달\r\n            session.removeAttribute(\"errorMessage\"); // 1회성 노출 후 제거\r\n        }\r\n        return \"users/login\";\r\n    }\r\n\r\n    @GetMapping(\"/mypage\")\r\n    public String mypage(Authentication authentication, Model model) {\r\n        // 1. 인증 객체 체크 (로그인 여부 확인)\r\n        if (authentication == null || !authentication.isAuthenticated()\r\n                || \"anonymousUser\".equals(authentication.getPrincipal())) {\r\n            return \"redirect:/users/login\";\r\n        }\r\n\r\n        String userId = \"\";\r\n\r\n        // 2. 인증 객체 타입에 따라 DB 조회용 ID 추출\r\n        if (authentication instanceof OAuth2AuthenticationToken) {\r\n            // 소셜 로그인인 경우\r\n            OAuth2AuthenticationToken oauthToken = (OAuth2AuthenticationToken) authentication;\r\n            String registrationId = oauthToken.getAuthorizedClientRegistrationId();\r\n            OAuth2User oAuth2User = oauthToken.getPrincipal();\r\n\r\n            String socialId = \"\";\r\n            if (\"naver\".equals(registrationId)) {\r\n                java.util.Map<String, Object> response = (java.util.Map<String, Object>) oAuth2User.getAttribute(\"response\");\r\n                socialId = (String) response.get(\"id\");\r\n            } else {\r\n                socialId = oAuth2User.getName(); // 카카오, 구글 등\r\n            }\r\n            userId = registrationId + \"_\" + socialId;\r\n        } else {\r\n            // 일반 로그인인 경우 (시큐리티 세션에 저장된 id 사용)\r\n            userId = authentication.getName();\r\n        }\r\n\r\n        // 3. DB 조회 (최신 사용자 정보 가져오기)\r\n        User latestUserInfo = userService.findById(userId);\r\n\r\n        if (latestUserInfo == null) {\r\n            System.out.println(\"조회된 유저가 없습니다. ID: \" + userId);\r\n            return \"redirect:/users/login\";\r\n        }\r\n\r\n        // 4. 아이디 길이에 대응하는 마스킹 및 디스플레이 로직\r\n        String displayId = \"\";\r\n\r\n        // 소셜 로그인 사이트 정보가 있는 경우 (소셜 회원)\r\n        if (latestUserInfo.getSocialLoginSite() != null && !latestUserInfo.getSocialLoginSite().isEmpty()) {\r\n            displayId = latestUserInfo.getSocialLoginSite().toUpperCase();\r\n        }\r\n        // 일반 회원인 경우 (아이디 마스킹 처리)\r\n        else {\r\n            String realId = latestUserInfo.getId(); // DB의 실제 아이디 사용\r\n            int len = (realId != null) ? realId.length() : 0;\r\n\r\n            if (len == 0) {\r\n                displayId = \"Unknown\";\r\n            } else if (len <= 3) {\r\n                // 아이디가 3자 이하로 매우 짧은 경우: 첫 글자만 노출\r\n                displayId = realId.substring(0, 1) + \"*\".repeat(len - 1);\r\n            } else if (len <= 6) {\r\n                // 아이디가 4~6자인 경우: 앞 2글자만 노출\r\n                displayId = realId.substring(0, 2) + \"*\".repeat(len - 2);\r\n            } else {\r\n                // 아이디가 7자 이상인 경우: 앞 3글자만 노출\r\n                displayId = realId.substring(0, 3) + \"*\".repeat(len - 3);\r\n            }\r\n        }\r\n\r\n        model.addAttribute(\"user\", latestUserInfo);\r\n        model.addAttribute(\"displayId\", displayId);\r\n        return \"users/mypage\";\r\n    }\r\n\r\n    // UserController.java\r\n\r\n    @GetMapping(\"/edit\") // 수정 폼 호출\r\n    public String editForm(Authentication authentication, Model model) {\r\n        // 1. 로그인 여부 및 인증 객체 체크 (마이페이지와 동일한 안전 로직)\r\n        if (authentication == null || !authentication.isAuthenticated()\r\n                || \"anonymousUser\".equals(authentication.getPrincipal())) {\r\n            return \"redirect:/users/login\";\r\n        }\r\n\r\n        String userId = \"\";\r\n\r\n        // 2. 인증 객체 타입에 따라 DB 조회용 ID 추출\r\n        if (authentication instanceof OAuth2AuthenticationToken) {\r\n            OAuth2AuthenticationToken oauthToken = (OAuth2AuthenticationToken) authentication;\r\n            String registrationId = oauthToken.getAuthorizedClientRegistrationId();\r\n            OAuth2User oAuth2User = oauthToken.getPrincipal();\r\n\r\n            if (\"naver\".equals(registrationId)) {\r\n                java.util.Map<String, Object> response = (java.util.Map<String, Object>) oAuth2User.getAttribute(\"response\");\r\n                userId = registrationId + \"_\" + (String) response.get(\"id\");\r\n            } else {\r\n                userId = registrationId + \"_\" + oAuth2User.getName();\r\n            }\r\n        } else {\r\n            userId = authentication.getName();\r\n        }\r\n\r\n        // 3. DB에서 최신 유저 정보 조회하여 폼에 전달\r\n        User user = userService.findById(userId);\r\n        model.addAttribute(\"user\", user);\r\n\r\n        return \"users/edit\";\r\n    }\r\n\r\n    @PostMapping(\"/edit\")\r\n    public String edit(@ModelAttribute User user,\r\n                       @RequestParam(value = \"newPassword\", required = false) String newPassword,\r\n                       RedirectAttributes rttr) {\r\n\r\n        // 1. DB에서 현재 저장된 유저의 정보를 먼저 가져옵니다 (기존 비밀번호 확인용)\r\n        User existingUser = userService.findById(user.getId());\r\n\r\n        // 2. 새 비밀번호가 실제로 입력되었는지 검사 (null이 아니고, 공백이 아닐 때만)\r\n        if (newPassword != null && !newPassword.trim().isEmpty()) {\r\n            // 사용자가 새 비밀번호를 입력했다면 암호화해서 세팅\r\n            user.setPassword(passwordEncoder.encode(newPassword));\r\n        } else {\r\n            // 입력하지 않았다면 DB에 있던 기존 암호화된 비밀번호를 그대로 다시 세팅\r\n            user.setPassword(existingUser.getPassword());\r\n        }\r\n\r\n        // 3. 서비스 호출 (이제 비밀번호가 안전하게 보존된 상태로 업데이트됩니다)\r\n        userService.edit(user);\r\n\r\n        rttr.addFlashAttribute(\"msg\", \"정보 수정이 완료되었습니다.\");\r\n        return \"redirect:/users/mypage\";\r\n    }\r\n\r\n    @PostMapping(\"/remove\") // 회원 탈퇴 요청\r\n    public String remove(@AuthenticationPrincipal User user) {\r\n        userService.remove(user.getUser_id());\r\n        return \"redirect:/\";\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/PickMeal/src/main/java/PickMeal/PickMeal/controller/UserController.java b/PickMeal/src/main/java/PickMeal/PickMeal/controller/UserController.java
--- a/PickMeal/src/main/java/PickMeal/PickMeal/controller/UserController.java	(revision 3ce52af0324eeed871bd48afd3b701eb40a0238c)
+++ b/PickMeal/src/main/java/PickMeal/PickMeal/controller/UserController.java	(date 1771922136783)
@@ -98,6 +98,11 @@
         return "users/login";
     }
 
+    @GetMapping("/forgot-pw")
+    public String forgotPwPage() {
+        return "users/forgot-pw"; // templates/users/forgot-pw.html 반환
+    }
+
     @GetMapping("/mypage")
     public String mypage(Authentication authentication, Model model) {
         // 1. 인증 객체 체크 (로그인 여부 확인)
Index: PickMeal/src/main/java/PickMeal/PickMeal/controller/MainController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package PickMeal.PickMeal.controller;\r\n\r\nimport PickMeal.PickMeal.domain.User;\r\nimport org.springframework.ui.Model;\r\nimport org.springframework.security.core.annotation.AuthenticationPrincipal;\r\nimport org.springframework.stereotype.Controller;\r\nimport org.springframework.web.bind.annotation.GetMapping;\r\n\r\n@Controller\r\npublic class MainController {\r\n\r\n    @GetMapping(\"/\")\r\n    public String index() {\r\n        return \"index\"; // 인트로 화면\r\n    }\r\n\r\n    @GetMapping(\"/next-page\") //\r\n    public String next() {\r\n        return \"next-page\";\r\n    }\r\n\r\n    @GetMapping(\"/game\")\r\n    public String gamePage() {\r\n        return \"game/game\"; // templates/game.html 파일을 찾아서 보여줌\r\n    }\r\n\r\n\r\n    @GetMapping(\"/board\")\r\n    public String boardPage() {\r\n        return \"board/board\"; // templates/board.html 파일을 반환\r\n    }\r\n\r\n\r\n    @GetMapping(\"/mypage\")\r\n    public String mypage(@AuthenticationPrincipal User user, Model model) {\r\n        // 세션에 저장된 현재 로그인 유저 정보(@AuthenticationPrincipal)를 모델에 담습니다.\r\n        // 만약 User 객체가 null이면 로그인 페이지로 보내거나 예외 처리를 해야 합니다.\r\n        if (user == null) {\r\n            return \"redirect:/users/login\";\r\n        }\r\n\r\n        model.addAttribute(\"user\", user); // 'user'라는 이름으로 객체를 넘겨줌\r\n        return \"users/mypage\";\r\n    }\r\n    @GetMapping(\"/roulette\")\r\n    public String roulettePage() {\r\n        return \"game/roulette\"; // templates/roulette.html 반환\r\n    }\r\n\r\n    @GetMapping(\"/twentyQuestions\")\r\n    public String twentyQuestionsPage() {\r\n        return \"game/twentyQuestions\"; // templates/twentyQuestions.html 반환\r\n    }\r\n\r\n    @GetMapping(\"/forgot-pw\")\r\n    public String forgotPwPage() {\r\n        return \"users/forgot-pw\"; // templates/forgot-pw.html 파일을 반환\r\n    }\r\n\r\n    @GetMapping(\"/board/write\")\r\n    public String boardWritePage() {\r\n        return \"board/board-write\"; // templates/board-write.html 파일 반환\r\n    }\r\n\r\n    @GetMapping(\"/hotplace\")\r\n    public String hotplacePage() {\r\n        return \"hotplace\"; // templates/hotplace.html 파일 반환\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/PickMeal/src/main/java/PickMeal/PickMeal/controller/MainController.java b/PickMeal/src/main/java/PickMeal/PickMeal/controller/MainController.java
--- a/PickMeal/src/main/java/PickMeal/PickMeal/controller/MainController.java	(revision 3ce52af0324eeed871bd48afd3b701eb40a0238c)
+++ b/PickMeal/src/main/java/PickMeal/PickMeal/controller/MainController.java	(date 1771922113645)
@@ -31,17 +31,7 @@
     }
 
 
-    @GetMapping("/mypage")
-    public String mypage(@AuthenticationPrincipal User user, Model model) {
-        // 세션에 저장된 현재 로그인 유저 정보(@AuthenticationPrincipal)를 모델에 담습니다.
-        // 만약 User 객체가 null이면 로그인 페이지로 보내거나 예외 처리를 해야 합니다.
-        if (user == null) {
-            return "redirect:/users/login";
-        }
 
-        model.addAttribute("user", user); // 'user'라는 이름으로 객체를 넘겨줌
-        return "users/mypage";
-    }
     @GetMapping("/roulette")
     public String roulettePage() {
         return "game/roulette"; // templates/roulette.html 반환
@@ -52,10 +42,7 @@
         return "game/twentyQuestions"; // templates/twentyQuestions.html 반환
     }
 
-    @GetMapping("/forgot-pw")
-    public String forgotPwPage() {
-        return "users/forgot-pw"; // templates/forgot-pw.html 파일을 반환
-    }
+
 
     @GetMapping("/board/write")
     public String boardWritePage() {

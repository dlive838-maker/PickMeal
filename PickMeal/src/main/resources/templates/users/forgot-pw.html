<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pick Meal - Forgot Password</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700;800&display=swap" rel="stylesheet">
  <style>
    body {
        font-family: 'Fredoka', sans-serif;
        background-color: #FFF5F0;
        margin: 0;
        overflow: hidden;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .nav-link { font-family: 'Fredoka', sans-serif; font-weight: 700; font-style: italic; }

    /* [í†µì¼ëœ ì• ë‹ˆë©”ì´ì…˜] ì½˜í…ì¸  ì˜ì—­ ì „ìš© ìƒìŠ¹ íš¨ê³¼ */
    .content-slide-up {
        animation: slideUp 0.8s cubic-bezier(0.65, 0, 0.35, 1) forwards;
        will-change: transform, opacity;
    }

    @keyframes slideUp {
        from { transform: translateY(100px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .forgot-card { border-radius: 3rem; background: white; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
    .input-field { border-radius: 1.2rem; transition: all 0.3s; border: 2px solid #FDF5E6; width: 100%; }
    .input-field:focus { border-color: #FF8A5B; outline: none; background: white; }

    .btn-primary { background-color: #FF8A5B; transition: all 0.3s; }
    .btn-primary:hover { background-color: #e67a4d; transform: scale(1.02); }

    .btn-check {
        background-color: #FF8A5B;
        color: white;
        font-weight: 800;
        border-radius: 1.2rem;
        padding: 0 1.5rem;
        white-space: nowrap;
        transition: all 0.3s;
        flex-shrink: 0;
    }
  </style>
</head>
<body>
<header th:replace="~{fragments/header :: headerFragment}"></header>

<main class="flex-grow flex items-center justify-center content-slide-up">
  <div class="forgot-card p-12 w-full max-w-lg text-center mx-4 border-2 border-gray-50">
    <h2 class="text-4xl font-black text-[#FF8A5B] italic mb-2 uppercase tracking-tighter">Reset Password</h2>
    <p class="text-gray-400 font-bold mb-10 italic">Enter your ID and Email to recover</p>

    <form id="forgotForm" class="space-y-6 text-left">
      <div class="space-y-2">
        <label class="font-black text-gray-700 italic ml-2 uppercase text-sm">Identification</label>
        <input type="text" id="userId" placeholder="YOUR ID" class="input-field px-6 py-4 bg-gray-50 font-bold" required>
      </div>

      <div class="space-y-2">
        <label class="font-black text-gray-700 italic ml-2 uppercase text-sm">Email Verification</label>
        <div class="flex gap-2">
          <input type="email" id="userEmail" placeholder="REGISTERED EMAIL" class="input-field px-6 py-4 bg-gray-50 font-bold" required>
          <button type="button" onclick="verifyEmail()" class="btn-check shadow-sm uppercase text-xs">Verify</button>
        </div>
      </div>

      <button type="submit" class="btn-primary w-full text-white py-5 rounded-full font-black text-xl shadow-lg transition italic uppercase active:scale-95 mt-4">
        Send Reset Link
      </button>
    </form>

    <div class="mt-8 text-sm font-bold text-gray-400 italic">
      Remembered your password?
      <a href="/login" class="text-[#FF8A5B] hover:underline ml-1">BACK TO LOGIN</a>
    </div>
  </div>
</main>

<script>
  document.getElementById('forgotForm').addEventListener('submit', async function(e) {
      e.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

      const id = document.getElementById('userId').value;
      const email = document.getElementById('userEmail').value;

      try {
          // ë°±ì—”ë“œ ì»¨íŠ¸ë¡¤ëŸ¬(@PostMapping("/find-password/send-link"))ë¡œ ë°ì´í„° ì „ì†¡
          const response = await fetch('/users/find-password/send-link', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: new URLSearchParams({
                  'id': id,
                  'email': email
              })
          });

          const result = await response.text();

          if (result === 'success') {
              alert("ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ê°€ ì´ë©”ì¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ í›„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•´ ì£¼ì„¸ìš”! âœ¨");
              location.href = '/login'; // ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
          } else if (result === 'not_found') {
              alert("ì…ë ¥í•˜ì‹  ì•„ì´ë””ì™€ ì´ë©”ì¼ ì •ë³´ê°€ ì¼ì¹˜í•˜ëŠ” íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤. âŒ");
          } else {
              alert("ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”. ğŸ˜¢");
          }
      } catch (error) {
          console.error('Error:', error);
          alert("ì„œë²„ì™€ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
  });

  // (ì°¸ê³ ) ë§Œì•½ 'Verify' ë²„íŠ¼ì´ ë‹¨ìˆœíˆ ì´ë©”ì¼ í˜•ì‹ì„ ì²´í¬í•˜ëŠ” ìš©ë„ë¼ë©´ ì•„ë˜ì²˜ëŸ¼ ë‚¨ê²¨ë‘˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  function verifyEmail() {
      const email = document.getElementById('userEmail').value;
      if(!email.includes('@')) {
          alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”! ğŸ“§");
      } else {
          alert("ì…ë ¥í•˜ì‹  ì´ë©”ì¼ í˜•ì‹ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ë‹¨ì˜ Send ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
      }
  }
</script>
</body>
</html>
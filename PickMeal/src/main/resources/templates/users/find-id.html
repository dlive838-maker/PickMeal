<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pick Meal - ì•„ì´ë”” ì°¾ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Fredoka', sans-serif; background-color: #FFF5F0; }
        .card { border-radius: 3rem; background: white; box-shadow: 0 20px 50px rgba(0,0,0,0.05); }
        .input-field { border-radius: 1.2rem; border: 2px solid #FDF5E6; width: 100%; padding: 1rem 1.5rem; font-weight: 700; transition: all 0.3s; }
        .input-field:focus { outline: none; border-color: #FF8A5B; background-color: white; box-shadow: 0 0 0 4px rgba(255, 138, 91, 0.1); }
        .btn-submit { background-color: #FF8A5B; color: white; font-weight: 800; border-radius: 1.2rem; transition: all 0.3s; }
        .btn-submit:hover { background-color: #e67a4d; transform: translateY(-2px); }

        /* ë¶€ë“œëŸ½ê²Œ ë‚˜íƒ€ë‚˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
<div class="card p-12 w-full max-w-md text-center border-2 border-gray-50">
    <h2 class="text-4xl font-black text-[#FF8A5B] italic mb-6 uppercase tracking-tighter">Find My ID</h2>

    <div class="space-y-4 text-left">
        <div>
            <label class="text-xs font-bold text-gray-400 ml-2 uppercase">Name</label>
            <input type="text" id="userName" placeholder="ê°€ì…í•˜ì‹  ì´ë¦„" class="input-field">
        </div>
        <div>
            <label class="text-xs font-bold text-gray-400 ml-2 uppercase">Email</label>
            <input type="email" id="userEmail" placeholder="ê°€ì…í•˜ì‹  ì´ë©”ì¼" class="input-field">
        </div>
        <button onclick="handleFindId()" class="btn-submit w-full py-4 mt-4 uppercase active:scale-95">Find ID</button>
    </div>

    <div id="resultArea" class="hidden mt-8 p-6 bg-orange-50 rounded-3xl border-2 border-dashed border-[#FF8A5B]">
        <p id="resultTitle" class="text-sm font-bold text-gray-500 mb-2">ì°¾ìœ¼ì‹œëŠ” ì•„ì´ë””ëŠ”</p>
        <p id="foundId" class="text-xl font-black text-[#FF8A5B] my-2 leading-tight"></p>

        <div id="actionButtons" class="mt-4 pt-4 border-t border-orange-200 flex justify-center gap-4">
            <a href="/users/login" class="text-xs font-bold text-gray-400 hover:text-[#FF8A5B] underline uppercase">ë¡œê·¸ì¸</a>
            <a id="findPwBtn" href="/users/forgot-pw" class="hidden text-xs font-bold text-gray-400 hover:text-[#FF8A5B] underline uppercase">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
        </div>
    </div>

    <div class="mt-8 text-xs font-bold text-gray-400 uppercase tracking-widest">
        <a href="/users/login" class="hover:text-[#FF8A5B] transition">Back to Login</a>
    </div>
</div>

<script>
    async function handleFindId() {
        const name = document.getElementById('userName').value.trim();
        const email = document.getElementById('userEmail').value.trim();
        const resultArea = document.getElementById('resultArea');
        const foundIdText = document.getElementById('foundId');
        const resultTitle = document.getElementById('resultTitle');
        const findPwBtn = document.getElementById('findPwBtn');

        if(!name || !email) return alert("ì´ë¦„ê³¼ ì´ë©”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ˜Š");

        try {
            const response = await fetch('/users/find-id', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ name: name, email: email })
            });

            if(response.ok) {
                const result = await response.text();

                resultArea.classList.add('hidden');
                resultArea.classList.remove('fade-in-up');

                if (result.startsWith("SOCIAL_")) {
                    const siteName = result.split("_")[1];
                    resultTitle.innerText = "ê°€ì… ì •ë³´ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤! âœ¨";
                    foundIdText.innerHTML = `í•´ë‹¹ ê³„ì •ì€ <span class="text-blue-500 underline">${siteName}</span> ê³„ì •ìœ¼ë¡œ<br>ì—°ë™ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`;
                    findPwBtn.classList.add('hidden'); // ì†Œì…œ ê³„ì •ì€ ë¹„ë²ˆì°¾ê¸° ìˆ¨ê¹€
                } else {
                    resultTitle.innerText = "ì°¾ìœ¼ì‹œëŠ” ì•„ì´ë””ëŠ”";
                    foundIdText.innerText = result;
                    findPwBtn.classList.remove('hidden'); // ì¼ë°˜ ê³„ì •ì€ ë¹„ë²ˆì°¾ê¸° ë³´ì„
                }

                resultArea.classList.remove('hidden');
                void resultArea.offsetWidth;
                resultArea.classList.add('fade-in-up');

            } else if(response.status === 404) {
                alert("ì¼ì¹˜í•˜ëŠ” íšŒì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¢");
                resultArea.classList.add('hidden');
            }
        } catch(e) {
            alert("ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }
</script>
</body>
</html>
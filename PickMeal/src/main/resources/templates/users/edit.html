<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pick Meal - Edit Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Fredoka', sans-serif; background-color: #FFF5F0; margin: 0; }
    .edit-card { border-radius: 3rem; background: white; box-shadow: 0 20px 50px rgba(0,0,0,0.05); border: 2px solid #FDF5E6; }

    .input-field {
        width: 100%; padding: 1rem 1.5rem; border-radius: 1.5rem;
        border: 2px solid #FFF5F0; background-color: #FDFDFD;
        font-weight: 800; color: #444; transition: all 0.3s ease;
        font-size: 1.15rem;
    }
    .input-field:focus {
        outline: none; border-color: #FF8A5B; background-color: white;
        box-shadow: 0 0 0 4px rgba(255, 138, 91, 0.1);
    }
    .input-readonly { background-color: #f9f9f9; color: #aaa; border: 2px solid #eee; cursor: not-allowed; }
    .label-text { color: #FFB08E; font-size: 0.85rem; font-weight: 800; margin-left: 1rem; margin-bottom: 0.2rem; display: block; }

    /* í•„í„° ì¤‘ë³µ ì„ íƒ ì‹œ ìƒ‰ìƒ ì±„ìš°ê¸° (Checkbox ê¸°ë°˜) */
    .peer:checked + label.like-tag { background-color: #3B82F6; color: white; border-color: #3B82F6; }
    .peer:checked + label.dislike-tag { background-color: #EF4444; color: white; border-color: #EF4444; }

    .content-slide-up { animation: slideUp 0.8s cubic-bezier(0.65, 0, 0.35, 1) forwards; }
    @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body class="min-h-screen flex flex-col">

<header th:replace="~{fragments/header :: headerFragment}"></header>

<main class="flex-grow container mx-auto px-6 pt-40 pb-20 max-w-6xl content-slide-up">
  <div class="text-center mb-16">
    <h2 class="text-6xl font-black text-[#FF8A5B] italic tracking-tighter uppercase inline-block relative">
      Edit Profile
      <span class="absolute -bottom-2 left-0 w-full h-2 bg-[#FF8A5B]/10 rounded-full"></span>
    </h2>
  </div>

  <form th:action="@{/users/edit}" th:object="${user}" method="post">
    <input type="hidden" th:field="*{user_id}">

    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
      <div class="edit-card p-12 space-y-6">
        <div>
          <label class="label-text">ì•„ì´ë”” (ë³€ê²½ë¶ˆê°€)</label>
          <input type="text" th:field="*{id}" class="input-field input-readonly" readonly>
        </div>
        <div>
          <label class="label-text">ì´ë©”ì¼ (ë³€ê²½ë¶ˆê°€)</label>
          <input type="email" th:field="*{email}" class="input-field input-readonly" readonly>
        </div>
        <div th:if="${user.socialLoginSite == null or user.socialLoginSite == ''}">
          <label class="label-text text-[#FF8A5B]">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" name="newPassword" class="input-field" placeholder="ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥">
        </div>
        <div>
          <label class="label-text">ë‹‰ë„¤ì„</label>
          <input type="text" th:field="*{nickname}" class="input-field">
        </div>
        <div>
          <label class="label-text">ì´ë¦„</label>
          <input type="text" th:field="*{name}" class="input-field">
        </div>
        <div>
          <label class="label-text">ì „í™”ë²ˆí˜¸</label>
          <input type="text" th:field="*{phoneNumber}" class="input-field">
        </div>
      </div>

      <div class="edit-card p-12 bg-[#FF8A5B]/2 space-y-10">
        <h3 class="text-3xl font-black text-[#FF8A5B] mb-10 italic uppercase tracking-tight">Taste Preference</h3>

        <div>
          <label class="label-text text-blue-400">ì¢‹ì•„í•˜ëŠ” ìŒì‹ â¤ï¸</label>
          <div class="flex flex-wrap gap-2 mt-2 mb-4">
            <th:block th:each="food : ${ {'í•œì‹', 'ì¼ì‹', 'ì¤‘ì‹', 'ì–‘ì‹', 'ì¹˜í‚¨', 'í”¼ì', 'ê³ ê¸°', 'ë©´ìš”ë¦¬', 'ë¶„ì‹', 'ë””ì €íŠ¸'} }">
              <input type="checkbox" th:id="${'like-' + food}" name="likeMenuCheck" th:value="${food}"
                     class="hidden peer">
              <label th:for="${'like-' + food}"
                     class="like-tag px-4 py-2 border-2 border-blue-100 text-blue-400 rounded-full cursor-pointer font-bold text-xs transition-all hover:bg-blue-50">
                [[${food}]]
              </label>
            </th:block>
          </div>
          <input type="text" id="likeInput" th:field="*{likeMenu}" class="input-field text-lg" placeholder="ì—¬ëŸ¬ ê°œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div>
          <label class="label-text text-red-400">ì‹«ì–´í•˜ëŠ” ìŒì‹ ğŸ’”</label>
          <div class="flex flex-wrap gap-2 mt-2 mb-4">
            <th:block th:each="food : ${ {'ê³ ìˆ˜', 'ì˜¤ì´', 'ê°€ì§€', 'ë¯¼ì´ˆ', 'ë§¤ìš´ê²ƒ', 'ëŠë¼í•œê²ƒ', 'í•´ì‚°ë¬¼', 'ë‚ ê²ƒ', 'í–¥ì‹ ë£Œ'} }">
              <input type="checkbox" th:id="${'dislike-' + food}" name="disLikeMenuCheck" th:value="${food}"
                     class="hidden peer">
              <label th:for="${'dislike-' + food}"
                     class="dislike-tag px-4 py-2 border-2 border-red-100 text-red-400 rounded-full cursor-pointer font-bold text-xs transition-all hover:bg-red-50">
                [[${food}]]
              </label>
            </th:block>
          </div>
          <input type="text" id="dislikeInput" th:field="*{disLikeMenu}" class="input-field text-lg" placeholder="ì—¬ëŸ¬ ê°œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
        </div>
      </div>
    </div>

    <div class="mt-16 flex justify-center gap-6">
      <button type="submit"
              class="px-12 py-5 bg-[#FF8A5B] text-white rounded-full font-black text-xl shadow-xl hover:bg-[#e67a4d] hover:scale-105 transition-all duration-300 italic uppercase">
        Save Changes
      </button>
      <a th:href="@{/users/mypage}"
         class="px-12 py-5 bg-slate-200 text-slate-500 rounded-full font-black text-xl hover:bg-red-50 hover:text-red-500 transition-all duration-300 italic uppercase">
        Cancel
      </a>
    </div>
  </form>
</main>

<script>
  // ì¤‘ë³µ ì„ íƒëœ ê°’ì„ ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ì°½ì— ë„£ì–´ì£¼ëŠ” ìŠ¤í¬ë¦½íŠ¸
  function updateInput(groupName, inputId) {
      const checkboxes = document.querySelectorAll(`input[name="${groupName}"]:checked`);
      const values = Array.from(checkboxes).map(cb => cb.value);
      document.getElementById(inputId).value = values.join(', ');
  }

  document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', (e) => {
          if (e.target.name === 'likeMenuCheck') {
              updateInput('likeMenuCheck', 'likeInput');
          } else if (e.target.name === 'disLikeMenuCheck') {
              updateInput('disLikeMenuCheck', 'dislikeInput');
          }
      });
  });
</script>

</body>
</html>
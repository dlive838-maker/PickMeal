<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pick Meal - ì›”ë“œì»µ ì„¤ì •</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700;800&display=swap" rel="stylesheet">
    <style>
        /* ë¡œê·¸ì¸ í˜ì´ì§€ì™€ ë™ì¼í•œ ë°°ê²½ ë° í°íŠ¸ ì„¤ì • */
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #FFF5F0;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* ì½˜í…ì¸  ìƒìŠ¹ ì• ë‹ˆë©”ì´ì…˜ */
        .content-slide-up {
            animation: slideUp 0.8s cubic-bezier(0.65, 0, 0.35, 1) forwards;
        }
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ì¹´ë“œ ë””ìì¸ */
        .setup-card {
            border-radius: 3rem;
            background: white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.05);
            border: 2px solid #fcfcfc;
        }

        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        .category-checkbox:checked + span {
            background-color: #FF8A5B;
            color: white;
            transform: scale(1.05);
            border-color: #FF8A5B;
        }
    </style>
</head>
<body class="items-center justify-center p-4">
<header th:replace="~{fragments/header :: headerFragment}"></header>
<main class="w-full max-w-2xl content-slide-up">
    <div class="setup-card p-10 md:p-16 text-center">
        <h1 class="text-4xl font-black text-[#FF8A5B] italic mb-2 uppercase tracking-tighter">
            ğŸ† ìŒì‹ ì›”ë“œì»µ ì„¤ì •
        </h1>
        <p class="text-gray-400 font-bold mb-10 italic">ì·¨í–¥ëŒ€ë¡œ í† ë„ˆë¨¼íŠ¸ë¥¼ êµ¬ì„±í•´ë³´ì„¸ìš”!</p>

        <div class="mb-12">
            <h2 class="text-[#FF8A5B] font-extrabold text-xl mb-6 italic uppercase tracking-tight">
                Step 1. ìŒì‹ ì¢…ë¥˜ ì„ íƒ
            </h2>
            <div class="flex flex-wrap justify-center gap-3">
                <th:block th:each="type : ${ {'Korean food', 'Chinese food', 'Japanese food', 'Western food', 'Asian food'} }">
                    <label class="cursor-pointer">
                        <input type="checkbox" name="foodType" th:value="${type}" class="hidden category-checkbox">
                        <span class="px-6 py-3 bg-gray-50 border-2 border-transparent rounded-full font-bold text-gray-500 transition-all hover:bg-orange-50 inline-block italic">
                            [[${type == 'Korean food' ? 'í•œì‹' :(type == 'Chinese food' ? 'ì¤‘ì‹' :(type == 'Japanese food' ? 'ì¼ì‹' :(type == 'Western food' ? 'ì–‘ì‹' :(type == 'Asian food' ? 'ì•„ì‹œì•ˆì‹' : type))))}]]
                        </span>
                    </label>
                </th:block>

                <label class="cursor-pointer">
                    <input type="checkbox" id="allCheck" onclick="toggleAll(this)" class="hidden category-checkbox">
                    <span class="px-6 py-3 bg-gray-200 border-2 border-transparent rounded-full font-black text-gray-700 transition-all inline-block italic">
                        ALL (ì „ì²´)
                    </span>
                </label>
            </div>
        </div>

        <div class="mb-12">
            <h2 class="text-[#FF8A5B] font-extrabold text-xl mb-6 italic uppercase tracking-tight">
                Step 2. ë¼ìš´ë“œ(ëª‡ ê°•) ì„ íƒ
            </h2>
            <div class="relative max-w-xs mx-auto">
                <select id="roundSelect"
                        class="w-full px-6 py-4 bg-gray-50 border-2 border-[#FF8A5B] rounded-2xl font-bold text-[#FF8A5B] focus:outline-none cursor-pointer text-center appearance-none">
                    <option value="8">8ê°• (ê°€ë³ê²Œ í•œ íŒ)</option>
                    <option value="16" selected>16ê°• (ê°€ì¥ ì¸ê¸°!ğŸ”¥)</option>
                    <option value="32">32ê°• (ì§„ê²€ ìŠ¹ë¶€)</option>
                    <option value="64">64ê°• (ë¨¹ë°© ê³ ìˆ˜)</option>
                    <option value="128">128ê°• (ëì¥ ë³´ê¸°)</option>
                </select>
            </div>
        </div>

        <button onclick="checkAndStart()"
                class="w-full max-w-sm bg-[#FF8A5B] text-white py-5 rounded-full font-black text-2xl shadow-lg hover:scale-105 transition-all duration-300 italic uppercase active:scale-95">
            Let's Start! ğŸš€
        </button>
    </div>
</main>
<footer th:replace="~{fragments/footer :: footerFragment}"></footer>
<script>
    // ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë˜, ìŠ¤íƒ€ì¼ ë°˜ì˜ì„ ìœ„í•œ ì½”ë“œë§Œ ìœ ì§€í•©ë‹ˆë‹¤.
    const foodCounts = { 'Korean food': 24, 'Chinese food': 23, 'Japanese food': 29, 'Western food': 34, 'Asian food': 23 };

    function toggleAll(source) {
        const checkboxes = document.getElementsByName('foodType');
        checkboxes.forEach(cb => cb.checked = source.checked);
        updateAvailableRounds();
    }

    function updateAllCheck() {
        const allCheck = document.getElementById('allCheck');
        const checkboxes = Array.from(document.getElementsByName('foodType'));
        const isAllChecked = checkboxes.every(cb => cb.checked);
        allCheck.checked = isAllChecked;
        updateAvailableRounds();
    }

    function updateAvailableRounds() {
        const selectedTypes = Array.from(document.querySelectorAll('input[name="foodType"]:checked'))
                                   .map(cb => cb.value);
        let totalCount = 0;
        selectedTypes.forEach(type => { if(foodCounts[type]) totalCount += foodCounts[type]; });

        const roundSelect = document.getElementById('roundSelect');
        const options = roundSelect.options;

        for (let i = 0; i < options.length; i++) {
            const roundValue = parseInt(options[i].value);
            if (roundValue <= totalCount) {
                options[i].disabled = false;
                options[i].classList.remove('text-gray-300');
            } else {
                options[i].disabled = true;
                options[i].classList.add('text-gray-300');
            }
        }
        // ì„ íƒëœ ë¼ìš´ë“œê°€ ë¹„í™œì„±í™”ë˜ë©´ ê°€ëŠ¥í•œ ê°€ì¥ ë†’ì€ ë¼ìš´ë“œë¡œ ë³€ê²½
        if (roundSelect.options[roundSelect.selectedIndex].disabled) {
            for (let i = options.length - 1; i >= 0; i--) {
                if (!options[i].disabled) {
                    roundSelect.value = options[i].value;
                    break;
                }
            }
        }
    }

    document.getElementsByName('foodType').forEach(cb => {
        cb.addEventListener('change', updateAllCheck);
    });

    function checkAndStart() {
        const selected = Array.from(document.querySelectorAll('input[name="foodType"]:checked'))
                              .map(cb => cb.value);
        if (selected.length === 0) { alert("ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!"); return; }
        const round = document.getElementById('roundSelect').value;
        location.href = `/game/play?types=${selected.join(',')}&round=${round}`;
    }

    window.onload = updateAvailableRounds;
</script>
</body>
</html>
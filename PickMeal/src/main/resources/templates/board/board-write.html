<!DOCTYPE html>
<html lang="ko"xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pick Meal - Write Post</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/lang/summernote-ko-KR.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700;800&family=Jua&family=Nanum+Gothic:wght@700;800&family=Gamja+Flower&family=Black+Han+Sans&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/post/write.css">

  <meta name="_csrf" th:content="${_csrf?.token}" th:if="${_csrf}"/>
  <meta name="_csrf_header" th:content="${_csrf?.headerName}" th:if="${_csrf}"/>

  <style>
    body {
        font-family: 'Fredoka', sans-serif;
        background-color: #FFF5F0;
        margin: 0;
        overflow: hidden;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .nav-link { font-family: 'Fredoka', sans-serif; font-weight: 700; font-style: italic; }

    .content-slide-up {
        animation: slideUp 0.8s cubic-bezier(0.65, 0, 0.35, 1) forwards;
        will-change: transform, opacity;
    }

    @keyframes slideUp {
        from { transform: translateY(100px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .write-card {
        border-radius: 3rem;
        background: white;
        box-shadow: 0 20px 50px rgba(0,0,0,0.1);
    }

    /* íˆ´ë°” ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ ìµœì í™” */
    .toolbar-btn {
        background-color: #FFF5EF;
        color: #FF8A5B;
        padding: 0.5rem 0.8rem;
        border-radius: 0.8rem;
        font-weight: 800;
        transition: all 0.2s;
        font-size: 0.8rem;
        border: none;
        outline: none;
        cursor: pointer;
    }
    .toolbar-btn:hover {
        background-color: #FF8A5B;
        color: white;
    }

    .input-field {
        border-radius: 1.5rem;
        transition: all 0.3s;
        border: 2px solid #FDF5E6;
        width: 100%;
    }

    .input-field:focus {
        border-color: #FF8A5B;
        outline: none;
        background: white;
    }

    textarea.input-field {
        resize: none;
        height: 300px;
        font-family: 'Fredoka', sans-serif;
    }

    /* ğŸŠğŸŠ ì¸ë¨¸ë…¸íŠ¸ë¥¼ ì“°ê¸°ìœ„í•œ ì»¤ìŠ¤í…€ css. ë°”ê¾¸ë ¤ë©´ ì´ ë¶€ë¶„ì„ ë°”ê¿”ì•¼í•¨! ğŸŠğŸŠ */
    /* ì—ë””í„° ì „ì²´ í…Œë‘ë¦¬ ì—†ì• ê³  ê¹”ë”í•˜ê²Œ */
    .note-editor.note-frame {
        border: none !important;
        box-shadow: none !important;
    }

    /* íˆ´ë°” ì˜ì—­ ë°°ê²½ìƒ‰ê³¼ ë‘¥ê·¼ í…Œë‘ë¦¬ ì„¤ì • (ê¸°ì¡´ ë””ìì¸ ìœ ì§€) */
    .note-toolbar {
        background-color: #FDF5E6 !important; /* ì—°í•œ ì˜¤ë Œì§€ìƒ‰ ë°°ê²½ */
        border-radius: 1.2rem !important;
        padding: 0.8rem !important;
        border-bottom: none !important;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }

    /* íˆ´ë°” ë²„íŠ¼ ê·¸ë£¹í•‘ ë°•ìŠ¤ íˆ¬ëª…í•˜ê²Œ */
    .note-btn-group {
        background: transparent !important;
        border: none !important;
        margin-right: 5px !important;
    }

    /* íˆ´ë°” ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ë‘¥ê¸€ê³  ì˜¤ë Œì§€ìƒ‰ ê¸€ì”¨) */
    .note-btn {
        background-color: #FFF5EF !important;
        color: #FF8A5B !important; /* ì˜¤ë Œì§€ìƒ‰ í¬ì¸íŠ¸ */
        border: none !important;
        border-radius: 0.8rem !important;
        padding: 0.6rem 0.9rem !important;
        font-weight: 800 !important;
        transition: all 0.2s !important;
        box-shadow: none !important;
    }

    /* ë²„íŠ¼ì— ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ & í´ë¦­ë˜ì—ˆì„ ë•Œ (í™œì„±í™”) */
    .note-btn:hover, .note-btn.active {
        background-color: #FF8A5B !important;
        color: white !important;
    }

    /* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìŠ¤íƒ€ì¼ (í°íŠ¸/í¬ê¸° ì„ íƒì°½) */
    .note-dropdown-menu {
        border-radius: 1rem !important;
        border: 2px solid #FDF5E6 !important;
        padding: 0.5rem !important;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1) !important;
    }
    /* ë“œë¡­ë‹¤ìš´ í•­ëª© í˜¸ë²„ íš¨ê³¼ */
    .note-dropdown-item:hover {
        background-color: #FFF5EF !important;
        color: #FF8A5B !important;
        border-radius: 0.5rem;
    }

    /* ê¸€ì“°ê¸° ë³¸ë¬¸ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .note-editable {
        background-color: #FAFAFA !important; /* ì•„ì£¼ ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
        border-radius: 1.5rem !important;
        border: 2px solid #FDF5E6 !important;
        padding: 2rem !important;
        font-family: 'Fredoka', sans-serif; /* ê¸°ë³¸ í°íŠ¸ ì„¤ì • */
        font-size: 20px;
        font-weight: bold;
        color: #444;
        line-height: 1.8 !important;
        min-height: 400px; /* ìµœì†Œ ë†’ì´ í™•ë³´ */
    }
    /* ë³¸ë¬¸ ì˜ì—­ í¬ì»¤ìŠ¤ ëì„ ë•Œ (ì£¼í™©ìƒ‰ í…Œë‘ë¦¬) */
    .note-editor.note-frame .note-editing-area .note-editable:focus {
        border-color: #FF8A5B !important;
        outline: none !important;
    }

    /* ìƒíƒœë°” (ë§¨ ì•„ë˜ resize bar) ìˆ¨ê¸°ê¸° */
    .note-statusbar {
        display: none !important;
    }

    /* Placeholder ìŠ¤íƒ€ì¼ */
    .note-placeholder {
        color: #ccc !important;
        font-family: 'Fredoka', sans-serif !important;
        font-weight: bold !important;
        padding: 2rem !important;
        font-size: 20px !important;
    }

    .note-editable ul {
    list-style-type: disc !important;
    list-style-position: inside !important;
    padding-left: 20px !important;
    margin-bottom: 10px !important;
    }

    .note-editable ol {
        list-style-type: decimal !important;
        list-style-position: inside !important;
        padding-left: 20px !important;
        margin-bottom: 10px !important;
    }
  </style>
</head>
<body>

<div class="overflow-y-auto flex-grow" >
  <header th:replace="~{fragments/header :: headerFragment}"></header>
  <main class="flex items-center justify-center content-slide-up py-10">
    <div class="write-card p-12 w-full max-w-4xl mx-4 border-2 border-gray-50">
      <div class="mb-8 text-center md:text-left">
        <h2 class="text-4xl font-black text-[#FF8A5B] italic uppercase tracking-tighter">New Post</h2>
        <p class="text-gray-400 font-bold italic">Express your taste in your own style!</p>
      </div>

      <form id="writeForm" th:action="@{/board/write}" method="post" enctype="multipart/form-data" class="space-y-6">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="space-y-2">
          <label for = "postTitle" class="font-black text-gray-700 italic ml-2 uppercase text-sm">Title</label>
          <input type="text" id="postTitle" name="title" placeholder="ì œëª©" class="input-field px-6 py-4 bg-gray-50 font-bold" required>
        </div>

        <div class="space-y-2">
          <label class="font-black text-gray-700 italic ml-2 uppercase text-sm">Content Editor</label>

          <textarea id="postContent" placeholder="ê¸€ ì‘ì„±" name="content" class="input-field px-6 py-6 bg-gray-50 font-bold leading-relaxed" style="font-size: 20px;" required></textarea>
        </div>

        <div class="flex gap-4 pt-6">
          <button type="button" onclick="location.href='/board'" class="flex-1 bg-gray-100 text-gray-400 py-4 rounded-full font-black text-xl shadow-sm hover:bg-gray-200 transition italic uppercase active:scale-95">
            Cancel
          </button>
          <button type="submit" class="flex-[2] bg-[#FF8A5B] text-white py-4 rounded-full font-black text-xl shadow-lg hover:scale-105 transition italic uppercase active:scale-95">
            Post it!
          </button>
        </div>
      </form>
    </div>
  </main>
  <footer th:replace="~{fragments/footer :: footerFragment}"></footer>
</div>

<script>

  // ì¸ë¨¸ë…¸íŠ¸ ì‚¬ìš©!!!! ğŸŠğŸŠğŸŠğŸŠğŸŠ

  $(document).ready(function() {
        // 1. ì¸ë¨¸ë…¸íŠ¸ ì—ë””í„° ì‹¤í–‰ (ì˜µì…˜ ì„¤ì •)
        $('#postContent').summernote({
            height: 500,                 // ì—ë””í„° ë†’ì´
            lang: "ko-KR",               // í•œê¸€ ì„¤ì •
            placeholder: 'ë‹¹ì‹ ì˜ ë§›ìˆëŠ” ê²½í—˜ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”! ğŸ•',
            disableResizeEditor: true,   // í¬ê¸° ì¡°ì ˆ ë°” ìˆ¨ê¸°ê¸°

            dialogsInBody: true,

            // ğŸŒŸ íˆ´ë°” ë²„íŠ¼ êµ¬ì„±ì„ ë‚´ ë§˜ëŒ€ë¡œ í¸ì§‘! (ì›ë˜ ìˆë˜ ê¸°ëŠ¥ë“¤ê³¼ ë¹„ìŠ·í•˜ê²Œ)
            toolbar: [
                // [ê·¸ë£¹ëª…, [ë²„íŠ¼ëª©ë¡]]
                ['font', ['fontname', 'fontsize']], // í°íŠ¸, í¬ê¸° ì„¤ì •
                ['style', ['bold', 'italic', 'underline', 'clear']], // êµµê²Œ, ê¸°ìš¸ì„, ë°‘ì¤„, ì§€ìš°ê¸°
                ['color', ['color']], // ê¸€ììƒ‰
                ['para', ['ul', 'ol', 'paragraph']], // ë¬¸ë‹¨ ì •ë ¬ (ì™¼ìª½, ê°€ìš´ë°, ì˜¤ë¥¸ìª½ ë“±)
                ['insert', ['picture', 'link']], // ì‚¬ì§„ ì²¨ë¶€, ë§í¬
                ['view', ['fullscreen', 'codeview', 'help']] // ì „ì²´í™”ë©´, ì½”ë“œë³´ê¸°
            ],

            // ì‚¬ìš©í•  í°íŠ¸ ëª©ë¡ ì¶”ê°€
            fontNames: ['Fredoka', 'Jua', 'Nanum Gothic', 'Gamja Flower', 'Black Han Sans', 'Arial'],
            fontNamesIgnoreCheck: ['Fredoka', 'Jua', 'Nanum Gothic', 'Gamja Flower', 'Black Han Sans'],

            // S3 ì´ë¯¸ì§€ ì—…ë¡œë“œ ì½œë°± í•¨ìˆ˜ ì—°ê²°
            callbacks: {
                onImageUpload: function(files) {
                    for (let i = 0; i < files.length; i++) {
                        uploadImageToS3(files[i], this);
                    }
                }
            }
        });
    });

 // ğŸŒŸ ìš°ë¦¬ê°€ ë§Œë“  ë°±ì—”ë“œ APIë¡œ ì‚¬ì§„ì„ ë³´ë‚´ê³  S3 ì£¼ì†Œë¥¼ ë°›ì•„ì˜¤ëŠ” í•¨ìˆ˜
function uploadImageToS3(file, editor) {
    let data = new FormData();
    data.append("file", file); // ë°±ì—”ë“œì˜ @RequestParam("file") ê³¼ ì´ë¦„ì´ ê°™ì•„ì•¼ í•¨!

    const csrfToken = document.querySelector('meta[name="_csrf"]').content;
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;

    $.ajax({
        data: data,
        type: "POST",
        url: "/file/upload", // ë°±ì—”ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ ì£¼ì†Œ
        contentType: false,
        processData: false,
        beforeSend: function(xhr) {
            xhr.setRequestHeader(csrfHeader, csrfToken);
        },
        success: function(s3ImageUrl) {
            $(editor).summernote('insertImage', s3ImageUrl);
        },
        error: function(error) {
            console.error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:", error);
            alert("ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
        }
    });
}

</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="_csrf" th:content="${_csrf?.token}" th:if="${_csrf}"/>
  <meta name="_csrf_header" th:content="${_csrf?.headerName}" th:if="${_csrf}"/>
  <title th:text="${board.title} + ' - PickMeal'">ê²Œì‹œê¸€ ìƒì„¸ - PickMeal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@700;800&family=Jua&family=Nanum+Gothic:wght@700;800&family=Gamja+Flower&family=Black+Han+Sans&display=swap" rel="stylesheet">
  <style>
    body {
        font-family: 'Fredoka', sans-serif;
        background-color: #FFF5F0;
        margin: 0;
        overflow: hidden;
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .nav-link { font-family: 'Fredoka', sans-serif; font-weight: 700; font-style: italic; }

    main {
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ë©”ì¸ íƒ€ì´í‹€ ì˜ì—­ ìŠ¤íƒ€ì¼ (ëª©ë¡ í™”ë©´ê³¼ í†µì¼) */
        .main-title-area {
            text-align: left;
            width: 100%;
            max-width: 900px;
            margin-bottom: 20px;
        }
        .main-title-area h1 {
            color: #FF7F50; /* ì£¼í™©ìƒ‰ í¬ì¸íŠ¸ ì»¬ëŸ¬ */
            font-size: 3em;
            margin: 0;
            /* í…ìŠ¤íŠ¸ í…Œë‘ë¦¬ íš¨ê³¼ (ì„ íƒ ì‚¬í•­) */
            /* -webkit-text-stroke: 1px #6D4C41; */
        }
        .main-title-area p {
            color: #FF7F50;
            font-size: 1.2em;
            margin-top: 10px;
        }

        /* ê²Œì‹œê¸€ ìƒì„¸ ì¹´ë“œ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .board-container {
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 40px;
            width: 100%;
            max-width: 900px;
            box-sizing: border-box;
        }

        /* ê²Œì‹œê¸€ í—¤ë” (ì œëª©, ì •ë³´) */
        .board-header {
            margin-bottom: 20px;
            border-bottom: 2px solid #FF7F50; /* í•˜ë‹¨ ì£¼í™©ìƒ‰ ì„  */
            padding-bottom: 20px;
        }
        .board-title {
            font-size: 2.2em;
            color: #FF7F50; /* ì£¼í™©ìƒ‰ ì œëª© */
            margin: 0 0 15px 0;
            word-break: break-all; /* ê¸´ ì œëª© ì¤„ë°”ê¿ˆ */
        }
        .board-meta {
            display: flex;
            justify-content: space-between;
            color: #777; /* ë©”íƒ€ ì •ë³´ëŠ” íšŒìƒ‰ìœ¼ë¡œ */
            font-size: 1em;
            flex-wrap: wrap; /* ì¢ì€ í™”ë©´ì—ì„œ ì¤„ë°”ê¿ˆ */
            gap: 10px;
        }
        .board-meta span {
            margin-right: 15px;
        }
        .like-count {
            color: #FF7F50;
            font-weight: bold;
        }

        /* ê²Œì‹œê¸€ ë³¸ë¬¸ ì˜ì—­ */
        .board-content {
            padding: 30px 0;
            min-height: 300px; /* ìµœì†Œ ë†’ì´ í™•ë³´ */
            font-size: 1.1em;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ, ê³µë°± ìœ ì§€ */
        }
        .board-content img {
            max-width: 100%; /* ì´ë¯¸ì§€ ë„˜ì¹¨ ë°©ì§€ */
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
        }

        /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */
        .board-buttons {
            display: flex;
            justify-content: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
            gap: 15px;
            margin-top: 30px;
            border-top: 1px solid #eee; /* ìƒë‹¨ íšŒìƒ‰ ì„  */
            padding-top: 30px;
        }

        /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 12px 25px;
            border-radius: 30px; /* ë‘¥ê·¼ ë²„íŠ¼ */
            font-size: 1.1em;
            font-family: 'Jua', sans-serif;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* ì£¼í™©ìƒ‰ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ìˆ˜ì • ë²„íŠ¼ ë“±) */
        .btn-orange {
            background-color: #FF7F50;
            color: white;
            box-shadow: 0 4px 0 #E64A19; /* ì…ì²´ê° ê·¸ë¦¼ì */
        }
        .btn-orange:hover {
            background-color: #FF6337;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #E64A19;
        }

        /* íšŒìƒ‰ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ëª©ë¡ ë²„íŠ¼) */
        .btn-light {
            background-color: #f0f0f0;
            color: #555;
            box-shadow: 0 4px 0 #d0d0d0;
        }
        .btn-light:hover {
            background-color: #e0e0e0;
            color: #333;
            transform: translateY(2px);
            box-shadow: 0 2px 0 #d0d0d0;
        }

        /* ë¹¨ê°„ìƒ‰ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì‚­ì œ ë²„íŠ¼) */
        .btn-danger {
            background-color: #FF5252;
            color: white;
            box-shadow: 0 4px 0 #D32F2F;
        }
        .btn-danger:hover {
             background-color: #FF1744;
             transform: translateY(2px);
             box-shadow: 0 2px 0 #D32F2F;
        }

    /* ğŸŠ ìƒì„¸ í˜ì´ì§€ ë³¸ë¬¸(Summernote HTML) ìŠ¤íƒ€ì¼ ë³µêµ¬ ğŸŠ */
    .post-content {
        font-family: 'Fredoka', sans-serif;
        font-size: 20px;
        font-weight: bold;
        color: #444;
        line-height: 1.8;
    }

    /* ê¸€ë¨¸ë¦¬ ê¸°í˜¸ & ë²ˆí˜¸ ë§¤ê¸°ê¸° ë³µêµ¬ */
    .post-content ul {
        list-style-type: disc !important;
        list-style-position: inside !important;
        padding-left: 20px !important;
        margin-bottom: 10px !important;
    }
    .post-content ol {
        list-style-type: decimal !important;
        list-style-position: inside !important;
        padding-left: 20px !important;
        margin-bottom: 10px !important;
    }

    /* ë³¸ë¬¸ ì•ˆì˜ ì‚¬ì§„ì´ ì‚ì ¸ë‚˜ê°€ì§€ ì•Šê²Œ (ë°˜ì‘í˜•) */
    .post-content img {
        max-width: 100%;
        height: auto;
        border-radius: 1rem; /* ì‚¬ì§„ ëª¨ì„œë¦¬ë„ ë‘¥ê¸€ê³  ì˜ˆì˜ê²Œ! */
        margin: 1rem 0;
    }

    /* ğŸŒŸ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë²„íŠ¼ ì˜ì—­ ìŠ¤íƒ€ì¼ ğŸŒŸ */
    .reaction-container {
        display: flex;
        justify-content: center;
        gap: 20px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
        margin: 40px 0 20px 0; /* ìœ„ì•„ë˜ ì—¬ë°± */
    }

    .reaction-btn {
        display: flex;
        align-items: center;
        gap: 10px; /* ì´ë¯¸ì§€ì™€ ìˆ«ì ì‚¬ì´ ê°„ê²© */
        padding: 10px 25px;
        border-radius: 30px;
        border: 2px solid #FDF5E6;
        background-color: white;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        font-family: 'Fredoka', 'Jua', sans-serif;
        font-size: 1.3em;
        font-weight: bold;
        color: #555;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .reaction-btn img {
        width: 28px;
        height: 28px;
        transition: transform 0.2s;
    }

    /* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ íš¨ê³¼ (ì¢‹ì•„ìš”ëŠ” íŒŒë€ë¹›, ì‹«ì–´ìš”ëŠ” ë¶‰ì€ë¹›) */
    .reaction-btn.like:hover {
        border-color: #007BFF;
        color: #007BFF;
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 123, 255, 0.2);
    }
    .reaction-btn.like:hover img {
        transform: scale(1.1) rotate(-10deg); /* ë”°ë´‰ í”ë“¤ê¸° */
    }

    .reaction-btn.dislike:hover {
        border-color: #FF5252;
        color: #FF5252;
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(255, 82, 82, 0.2);
    }
    .reaction-btn.dislike:hover img {
        transform: scale(1.1) rotate(10deg); /* ì—­ë”°ë´‰ í”ë“¤ê¸° */
    }

    /* ğŸŒŸ ì¢‹ì•„ìš” ëˆŒë €ì„ ë•Œ ë””ìì¸ ê³ ì • (.active ì¶”ê°€) */
    .reaction-btn.like:hover,
    .reaction-btn.like.active {
        border-color: #007BFF;
        color: #007BFF;
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0, 123, 255, 0.2);
    }
    .reaction-btn.like:hover img,
    .reaction-btn.like.active img {
        transform: scale(1.1) rotate(-10deg);
    }

    /* ğŸŒŸ ì‹«ì–´ìš” ëˆŒë €ì„ ë•Œ ë””ìì¸ ê³ ì • (.active ì¶”ê°€) */
    .reaction-btn.dislike:hover,
    .reaction-btn.dislike.active {
        border-color: #FF5252;
        color: #FF5252;
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(255, 82, 82, 0.2);
    }
    .reaction-btn.dislike:hover img,
    .reaction-btn.dislike.active img {
        transform: scale(1.1) rotate(10deg);
    }
  </style>
</head>
<body>

<header th:replace="~{fragments/header :: headerFragment}"></header>
<div class="overflow-y-auto flex-grow" >
  <main class="flex items-center justify-center content-slide-up py-10">
    <div class="main-title-area">
      <h1>COMMUNITY BOARD</h1>
      <p>Share your tasty experiences!</p>
    </div>

    <div class="board-container">
      <div class="board-header">
        <h2 class="board-title" th:text="${board.title}">ê²Œì‹œê¸€ ì œëª©</h2>

        <div class="board-meta">
          <div>
            <span th:text="'ê¸€ì“´ì´ : ' + ${board.nickname}">ì‘ì„±ì</span>
            <span th:if = "${board.updateDate == null}" th:text="'ì‘ì„±ì¼ : ' + ${#dates.format(board.createDate, 'yyyy-MM-dd HH:mm')}">ì‘ì„±ì¼</span>
            <span th:if = "${board.updateDate != null}" th:text="'ìµœì¢… ìˆ˜ì •ì¼ : ' + ${#dates.format(board.updateDate, 'yyyy-MM-dd HH:mm')}">ìµœì¢… ìˆ˜ì •ì¼</span>
          </div>
          <div>
            <span th:text="'VIEWS : ' + ${board.viewCount}">ì¡°íšŒìˆ˜</span>
            <span class="like-count">â¤ï¸ <span th:text="${board.likeCount}">15</span></span>
          </div>
        </div>
      </div>

      <div class="post-content" th:utext="${board.content}"></div>

      <div class="reaction-container">

        <button type="button" class="reaction-btn like"
                th:classappend="${userReaction == 1} ? 'active' : ''"
                th:onclick="|updateReaction(1, ${board.boardId})|">
          <img src="/images/thumbs-up.png" alt="ì¢‹ì•„ìš”">
          <span id="like-count" th:text="${board.likeCount}">0</span>
        </button>

        <button type="button" class="reaction-btn dislike"
                th:classappend="${userReaction == -1} ? 'active' : ''"
                th:onclick="|updateReaction(-1, ${board.boardId})|">
          <img src="/images/thumbs-down.png" alt="ì‹«ì–´ìš”">
          <span id="dislike-count" th:text="${board.dislikeCount}">0</span>
        </button>

      </div>

      <div class="board-buttons">
        <a href="/board/list" class="btn btn-light">ëª©ë¡ìœ¼ë¡œ</a>

        <th:block th:if="${isWriter}">
          <a th:href="@{/board/edit/{boardId}(boardId=${board.boardId})}" class="btn btn-orange">ìˆ˜ì •</a>
          <button type="button" class="btn btn-danger" th:boardId="${board.boardId}" onclick="deleteBoard(this.getAttribute('boardId'))">ì‚­ì œ</button>
        </th:block>
      </div>

      <hr class="my-5">
      <div class="comment-section container">
        <h4 class="mb-4">ëŒ“ê¸€ <span th:text="${#lists.size(comments)}">0</span></h4>

        <div class="card mb-4 shadow-sm">
          <div class="card-body">
            <form th:action="@{/comment/write/{boardId}(boardId=${board.boardId})}" th:method="post">
              <input type="hidden" name="boardId" th:value="${board.boardId}">

              <div class="form-group mb-2">
                    <textarea class="form-control" name="content" rows="3"
                              placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. ë¡œê·¸ì¸ í›„ì— ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤." required></textarea>
              </div>
              <div class="text-end">
                <button type="submit" class="btn btn-dark btn-sm">ëŒ“ê¸€ ë“±ë¡</button>
              </div>
            </form>
          </div>
        </div>

        <div class="comment-list">
          <div th:each="comment : ${comments}" class="border-bottom py-3">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <strong class="me-2" th:text="${comment.nickname}">ì‘ì„±ì</strong>
                <small class="text-muted" th:if = "${comment.updateCommentDate == null}" th:text="${#dates.format(comment.createCommentDate, 'yyyy-MM-dd HH:mm')}">2026-02-26</small>
                <small class="text-muted" th:if = "${comment.updateCommentDate != null}" th:text="${#dates.format(comment.createCommentDate, 'yyyy-MM-dd HH:mm')}">2026-02-26</small>
              </div>

              <div th:if="${user != null and user.user_id == comment.user_id}">
                <a th:href="@{/comment/delete/{id}(id=${comment_id}, boardId=${boardId})}"
                   class="btn btn-outline-danger btn-sm"
                   onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
              </div>
            </div>
            <div class="mt-2 text-secondary">
              <p class="mb-0" th:text="${comment.content}">ì—¬ê¸°ì— ëŒ“ê¸€ ë‚´ìš©ì´ ì¶œë ¥ë©ë‹ˆë‹¤.</p>
            </div>
          </div>

          <div th:if="${#lists.isEmpty(comments)}" class="text-center py-5 text-muted">
            ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!
          </div>
        </div>
      </div>

    </div>
  </main>
  <footer th:replace="~{fragments/footer :: footerFragment}"></footer>
</div>

<script th:inline="javascript">
    function deleteBoard(boardId) {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            const form = document.createElement('form');
            form.method = 'post';
            form.action = `/board/remove/${encodeURIComponent(boardId)}`;

            // 1. íƒ€ì„ë¦¬í”„ë¥¼ í†µí•´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ CSRF í† í° ê°’ ê°€ì ¸ì˜¤ê¸°
            const csrfToken = /*[[${_csrf.token}]]*/ '';
            const csrfParameter = /*[[${_csrf.parameterName}]]*/ '_csrf';

            // 2. í¼ ì•ˆì— ìˆ¨ê²¨ì§„ inputìœ¼ë¡œ CSRF í† í° ì™ ì§‘ì–´ë„£ê¸°
            if (csrfToken) {
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = csrfParameter;
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
            }

            document.body.appendChild(form);
            form.submit();
        }
    }

  // ğŸŒŸ ì¢‹ì•„ìš” / ì‹«ì–´ìš” í´ë¦­ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜ (AJAX ë¹„ë™ê¸° í†µì‹ ìš©)
    function updateReaction(likeType, boardId) {
        const csrfToken = document.querySelector('meta[name="_csrf"]').content;
        const csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;

        const formData = new FormData();
        formData.append("like_type", likeType);

        fetch(`/board/reaction/${boardId}`, {
            method: "POST",
            headers: {
                [csrfHeader]: csrfToken
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            }
        })
        .catch(error => {
            console.error("Error:", error);
        });
    }
</script>
</body>
</html>